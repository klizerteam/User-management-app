<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UserVault • Management System</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-void: #050508;
            --bg-deep: #0a0a10;
            --bg-surface: #111118;
            --bg-elevated: #18181f;
            --bg-hover: #1f1f28;
            
            --accent-primary: #6ee7b7;
            --accent-secondary: #34d399;
            --accent-glow: rgba(110, 231, 183, 0.4);
            --accent-blue: #60a5fa;
            --accent-amber: #fbbf24;
            --accent-rose: #fb7185;
            
            --text-primary: #f4f4f5;
            --text-secondary: #a1a1aa;
            --text-muted: #52525b;
            
            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-default: rgba(255, 255, 255, 0.1);
        }
        
        body {
            font-family: 'Sora', sans-serif;
            background: var(--bg-void);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        .font-mono {
            font-family: 'IBM Plex Mono', monospace;
        }
        
        /* Ambient background */
        .ambient-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
        }
        
        .ambient-bg::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse 600px 400px at 20% 30%, rgba(110, 231, 183, 0.08), transparent 50%),
                radial-gradient(ellipse 500px 300px at 80% 70%, rgba(96, 165, 250, 0.06), transparent 50%),
                radial-gradient(ellipse 400px 250px at 50% 50%, rgba(251, 191, 36, 0.04), transparent 50%);
            animation: ambientDrift 30s ease-in-out infinite;
        }
        
        @keyframes ambientDrift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(2%, -2%) rotate(1deg); }
            66% { transform: translate(-1%, 1%) rotate(-0.5deg); }
        }
        
        /* Noise texture overlay */
        .noise-overlay {
            position: fixed;
            inset: 0;
            z-index: -1;
            opacity: 0.015;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        
        /* Card styles */
        .card {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-elevated {
            background: var(--bg-elevated);
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.3),
                0 2px 4px -2px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.03);
        }
        
        /* Input styles */
        .input {
            width: 100%;
            background: var(--bg-deep);
            border: 1px solid var(--border-default);
            border-radius: 10px;
            padding: 14px 16px;
            font-size: 14px;
            color: var(--text-primary);
            font-family: 'Sora', sans-serif;
            transition: all 0.2s ease;
            outline: none;
        }
        
        .input:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }
        
        .input::placeholder {
            color: var(--text-muted);
        }
        
        .input-with-icon {
            padding-left: 48px;
        }
        
        /* Select styles */
        select.input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2371717a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6,9 12,15 18,9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 44px;
            cursor: pointer;
        }
        
        select.input option {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }
        
        /* Button styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Sora', sans-serif;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
        }
        
        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-void);
        }
        
        .btn-primary:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            box-shadow: 0 8px 24px -8px var(--accent-glow);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-default);
        }
        
        .btn-ghost:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--border-default);
        }
        
        .btn-icon {
            padding: 10px;
            border-radius: 8px;
        }
        
        .btn-edit {
            background: rgba(96, 165, 250, 0.1);
            color: var(--accent-blue);
            border: 1px solid rgba(96, 165, 250, 0.2);
        }
        
        .btn-edit:hover {
            background: rgba(96, 165, 250, 0.2);
        }
        
        .btn-delete {
            background: rgba(251, 113, 133, 0.1);
            color: var(--accent-rose);
            border: 1px solid rgba(251, 113, 133, 0.2);
        }
        
        .btn-delete:hover {
            background: rgba(251, 113, 133, 0.2);
        }
        
        /* Badge styles */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .badge-admin {
            background: rgba(251, 191, 36, 0.15);
            color: var(--accent-amber);
            border: 1px solid rgba(251, 191, 36, 0.25);
        }
        
        .badge-admin::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-amber);
        }
        
        .badge-user {
            background: rgba(110, 231, 183, 0.1);
            color: var(--accent-primary);
            border: 1px solid rgba(110, 231, 183, 0.2);
        }
        
        .badge-user::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-primary);
        }
        
        /* Table styles */
        .table-container {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            text-align: left;
            padding: 14px 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border-subtle);
            white-space: nowrap;
        }
        
        .table td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-subtle);
            vertical-align: middle;
        }
        
        .table tbody tr {
            transition: background 0.15s ease;
        }
        
        .table tbody tr:hover {
            background: var(--bg-hover);
        }
        
        .table tbody tr:last-child td {
            border-bottom: none;
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(5, 5, 8, 0.85);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 20px;
            animation: fadeIn 0.2s ease;
        }
        
        .modal {
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: 20px;
            width: 100%;
            max-width: 440px;
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.05);
            animation: modalSlide 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(10px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Toast styles */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 200;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .toast {
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: toastIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
        }
        
        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .toast-success {
            background: rgba(110, 231, 183, 0.15);
            border: 1px solid rgba(110, 231, 183, 0.3);
            color: var(--accent-primary);
        }
        
        .toast-error {
            background: rgba(251, 113, 133, 0.15);
            border: 1px solid rgba(251, 113, 133, 0.3);
            color: var(--accent-rose);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.4s ease forwards;
        }
        
        .animate-slideUp {
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        .delay-1 { animation-delay: 0.1s; opacity: 0; }
        .delay-2 { animation-delay: 0.15s; opacity: 0; }
        .delay-3 { animation-delay: 0.2s; opacity: 0; }
        .delay-4 { animation-delay: 0.25s; opacity: 0; }
        
        /* Spinner */
        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-default);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
        
        /* Avatar */
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        /* Utility */
        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, createContext, useContext, useCallback } = React;
        
        // =====================
        // CONFIG
        // =====================
        const API_URL = 'http://localhost:8000';
        
        // =====================
        // CONTEXT
        // =====================
        const AuthContext = createContext(null);
        const useAuth = () => useContext(AuthContext);
        
        // =====================
        // ICONS
        // =====================
        const Icons = {
            User: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
            ),
            Mail: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <rect x="2" y="4" width="20" height="16" rx="2"/>
                    <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                </svg>
            ),
            Lock: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
            ),
            LogOut: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16,17 21,12 16,7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
            ),
            Edit: () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                    <path d="m15 5 4 4"/>
                </svg>
            ),
            Trash: () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M3 6h18"/>
                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                    <line x1="10" y1="11" x2="10" y2="17"/>
                    <line x1="14" y1="11" x2="14" y2="17"/>
                </svg>
            ),
            X: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            ),
            Users: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
            ),
            Shield: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/>
                    <path d="m9 12 2 2 4-4"/>
                </svg>
            ),
            Check: () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <polyline points="20,6 9,17 4,12"/>
                </svg>
            ),
            AlertCircle: () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
            ),
        };
        
        // =====================
        // COMPONENTS
        // =====================
        
        // Toast
        const Toast = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 4000);
                return () => clearTimeout(timer);
            }, [onClose]);
            
            return (
                <div className={`toast toast-${type}`}>
                    {type === 'success' ? <Icons.Check /> : <Icons.AlertCircle />}
                    {message}
                </div>
            );
        };
        
        // Spinner
        const Spinner = () => <div className="spinner" />;
        
        // Logo
        const Logo = () => (
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                <div style={{
                    width: '42px',
                    height: '42px',
                    background: 'linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-blue) 100%)',
                    borderRadius: '12px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    boxShadow: '0 4px 12px -2px var(--accent-glow)'
                }}>
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--bg-void)" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/>
                    </svg>
                </div>
                <div>
                    <h1 style={{ fontSize: '18px', fontWeight: '700', letterSpacing: '-0.02em' }}>UserVault</h1>
                    <p className="font-mono" style={{ fontSize: '11px', color: 'var(--text-muted)' }}>v2.0.0</p>
                </div>
            </div>
        );
        
        // Input Field
        const InputField = ({ label, icon, ...props }) => (
            <div style={{ marginBottom: '16px' }}>
                {label && (
                    <label style={{ display: 'block', marginBottom: '8px', fontSize: '13px', fontWeight: '500', color: 'var(--text-secondary)' }}>
                        {label}
                    </label>
                )}
                <div style={{ position: 'relative' }}>
                    {icon && (
                        <div style={{ position: 'absolute', left: '16px', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-muted)' }}>
                            {icon}
                        </div>
                    )}
                    <input className={`input ${icon ? 'input-with-icon' : ''}`} {...props} />
                </div>
            </div>
        );
        
        // Select Field
        const SelectField = ({ label, options, ...props }) => (
            <div style={{ marginBottom: '16px' }}>
                {label && (
                    <label style={{ display: 'block', marginBottom: '8px', fontSize: '13px', fontWeight: '500', color: 'var(--text-secondary)' }}>
                        {label}
                    </label>
                )}
                <select className="input" {...props}>
                    {options.map(opt => (
                        <option key={opt.value} value={opt.value}>{opt.label}</option>
                    ))}
                </select>
            </div>
        );
        
        // Edit Modal
        const EditModal = ({ user, onClose, onSave }) => {
            const [name, setName] = useState(user.name);
            const [role, setRole] = useState(user.role);
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const { token, toast } = useAuth();
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                
                try {
                    const updateData = { name, role };
                    if (password.length >= 8) {
                        updateData.password = password;
                    }
                    
                    const response = await fetch(`${API_URL}/users/${user.id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(updateData)
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.detail || 'Update failed');
                    }
                    
                    const updatedUser = await response.json();
                    onSave(updatedUser);
                    toast('User updated successfully', 'success');
                    onClose();
                } catch (err) {
                    toast(err.message, 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={e => e.stopPropagation()}>
                        <div style={{ padding: '24px', borderBottom: '1px solid var(--border-subtle)', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                            <div>
                                <h2 style={{ fontSize: '18px', fontWeight: '600' }}>Edit User</h2>
                                <p style={{ fontSize: '13px', color: 'var(--text-muted)', marginTop: '4px' }}>{user.email}</p>
                            </div>
                            <button className="btn btn-icon btn-ghost" onClick={onClose}>
                                <Icons.X />
                            </button>
                        </div>
                        
                        <form onSubmit={handleSubmit} style={{ padding: '24px' }}>
                            <InputField
                                label="Full Name"
                                value={name}
                                onChange={e => setName(e.target.value)}
                                placeholder="Enter name"
                                icon={<Icons.User />}
                            />
                            
                            <SelectField
                                label="Role"
                                value={role}
                                onChange={e => setRole(e.target.value)}
                                options={[
                                    { value: 'user', label: 'User' },
                                    { value: 'admin', label: 'Admin' }
                                ]}
                            />
                            
                            <InputField
                                label="New Password (optional)"
                                type="password"
                                value={password}
                                onChange={e => setPassword(e.target.value)}
                                placeholder="Leave empty to keep current"
                                icon={<Icons.Lock />}
                            />
                            
                            <div style={{ display: 'flex', gap: '12px', marginTop: '24px' }}>
                                <button type="button" className="btn btn-ghost" style={{ flex: 1 }} onClick={onClose}>
                                    Cancel
                                </button>
                                <button type="submit" className="btn btn-primary" style={{ flex: 1 }} disabled={loading}>
                                    {loading ? <Spinner /> : 'Save Changes'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };
        
        // Delete Confirmation Modal
        const DeleteModal = ({ user, onClose, onConfirm, loading }) => (
            <div className="modal-overlay" onClick={onClose}>
                <div className="modal" onClick={e => e.stopPropagation()}>
                    <div style={{ padding: '32px', textAlign: 'center' }}>
                        <div style={{
                            width: '56px',
                            height: '56px',
                            borderRadius: '16px',
                            background: 'rgba(251, 113, 133, 0.15)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            margin: '0 auto 20px',
                            color: 'var(--accent-rose)'
                        }}>
                            <Icons.Trash />
                        </div>
                        <h2 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px' }}>Delete User</h2>
                        <p style={{ fontSize: '14px', color: 'var(--text-secondary)', marginBottom: '24px' }}>
                            Are you sure you want to delete <strong>{user.name}</strong>? This action cannot be undone.
                        </p>
                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button className="btn btn-ghost" style={{ flex: 1 }} onClick={onClose}>
                                Cancel
                            </button>
                            <button className="btn btn-delete" style={{ flex: 1 }} onClick={onConfirm} disabled={loading}>
                                {loading ? <Spinner /> : 'Delete User'}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        );
        
        // Stats Card
        const StatCard = ({ title, value, icon, color }) => (
            <div className="card card-elevated" style={{ padding: '24px' }}>
                <div style={{ display: 'flex', alignItems: 'flex-start', justifyContent: 'space-between' }}>
                    <div>
                        <p style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '8px' }}>{title}</p>
                        <p style={{ fontSize: '32px', fontWeight: '700', letterSpacing: '-0.02em' }}>{value}</p>
                    </div>
                    <div style={{
                        width: '48px',
                        height: '48px',
                        borderRadius: '14px',
                        background: `rgba(${color}, 0.12)`,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        color: `rgb(${color})`
                    }}>
                        {icon}
                    </div>
                </div>
            </div>
        );
        
        // User Row
        const UserRow = ({ user, onEdit, onDelete }) => {
            const colors = ['110, 231, 183', '96, 165, 250', '251, 191, 36', '251, 113, 133', '167, 139, 250'];
            const colorIndex = user.id % colors.length;
            const avatarColor = colors[colorIndex];
            
            return (
                <tr>
                    <td>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '14px' }}>
                            <div 
                                className="avatar" 
                                style={{ 
                                    background: `linear-gradient(135deg, rgba(${avatarColor}, 0.25), rgba(${avatarColor}, 0.1))`,
                                    color: `rgb(${avatarColor})`,
                                    border: `1px solid rgba(${avatarColor}, 0.2)`
                                }}
                            >
                                {user.name.charAt(0).toUpperCase()}
                            </div>
                            <div style={{ minWidth: 0 }}>
                                <p style={{ fontWeight: '500', marginBottom: '2px' }}>{user.name}</p>
                                <p className="font-mono truncate" style={{ fontSize: '12px', color: 'var(--text-muted)' }}>{user.email}</p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span className={`badge badge-${user.role}`}>{user.role}</span>
                    </td>
                    <td>
                        <span className="font-mono" style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>
                            {new Date(user.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                        </span>
                    </td>
                    <td>
                        <div style={{ display: 'flex', gap: '8px' }}>
                            <button className="btn btn-icon btn-edit" onClick={() => onEdit(user)} title="Edit user">
                                <Icons.Edit />
                            </button>
                            <button className="btn btn-icon btn-delete" onClick={() => onDelete(user)} title="Delete user">
                                <Icons.Trash />
                            </button>
                        </div>
                    </td>
                </tr>
            );
        };
        
        // =====================
        // PAGES
        // =====================
        
        // Login Page
        const LoginPage = ({ onSwitch }) => {
            const { login, toast } = useAuth();
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                
                try {
                    const formData = new URLSearchParams();
                    formData.append('username', email);
                    formData.append('password', password);
                    
                    const response = await fetch(`${API_URL}/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.detail || 'Login failed');
                    }
                    
                    const data = await response.json();
                    login(data.access_token);
                    toast('Welcome back!', 'success');
                } catch (err) {
                    toast(err.message, 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '24px' }}>
                    <div className="ambient-bg" />
                    <div className="noise-overlay" />
                    
                    <div style={{ width: '100%', maxWidth: '400px' }}>
                        <div className="card card-elevated animate-slideUp" style={{ padding: '40px' }}>
                            <div style={{ textAlign: 'center', marginBottom: '36px' }}>
                                <div style={{ display: 'flex', justifyContent: 'center', marginBottom: '24px' }}>
                                    <Logo />
                                </div>
                                <h2 style={{ fontSize: '22px', fontWeight: '600', marginBottom: '8px' }}>Welcome back</h2>
                                <p style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>Sign in to your account</p>
                            </div>
                            
                            <form onSubmit={handleSubmit}>
                                <InputField
                                    label="Email"
                                    type="email"
                                    value={email}
                                    onChange={e => setEmail(e.target.value)}
                                    placeholder="you@example.com"
                                    icon={<Icons.Mail />}
                                    required
                                />
                                
                                <InputField
                                    label="Password"
                                    type="password"
                                    value={password}
                                    onChange={e => setPassword(e.target.value)}
                                    placeholder="••••••••"
                                    icon={<Icons.Lock />}
                                    required
                                />
                                
                                <button type="submit" className="btn btn-primary" style={{ width: '100%', marginTop: '8px' }} disabled={loading}>
                                    {loading ? <Spinner /> : 'Sign In'}
                                </button>
                            </form>
                            
                            <p style={{ textAlign: 'center', marginTop: '24px', fontSize: '14px', color: 'var(--text-secondary)' }}>
                                Don't have an account?{' '}
                                <button onClick={onSwitch} style={{ background: 'none', border: 'none', color: 'var(--accent-primary)', fontWeight: '500', cursor: 'pointer' }}>
                                    Register
                                </button>
                            </p>
                        </div>
                        
                        <p className="font-mono" style={{ textAlign: 'center', marginTop: '24px', fontSize: '11px', color: 'var(--text-muted)' }}>
                            Secured with JWT + Argon2
                        </p>
                    </div>
                </div>
            );
        };
        
        // Register Page
        const RegisterPage = ({ onSwitch }) => {
            const { toast } = useAuth();
            const [name, setName] = useState('');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [role, setRole] = useState('user');
            const [loading, setLoading] = useState(false);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                
                try {
                    const response = await fetch(`${API_URL}/auth/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, email, password, role })
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.detail || 'Registration failed');
                    }
                    
                    toast('Account created! Please sign in.', 'success');
                    onSwitch();
                } catch (err) {
                    toast(err.message, 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '24px' }}>
                    <div className="ambient-bg" />
                    <div className="noise-overlay" />
                    
                    <div style={{ width: '100%', maxWidth: '400px' }}>
                        <div className="card card-elevated animate-slideUp" style={{ padding: '40px' }}>
                            <div style={{ textAlign: 'center', marginBottom: '36px' }}>
                                <div style={{ display: 'flex', justifyContent: 'center', marginBottom: '24px' }}>
                                    <Logo />
                                </div>
                                <h2 style={{ fontSize: '22px', fontWeight: '600', marginBottom: '8px' }}>Create account</h2>
                                <p style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>Join our platform today</p>
                            </div>
                            
                            <form onSubmit={handleSubmit}>
                                <InputField
                                    label="Full Name"
                                    value={name}
                                    onChange={e => setName(e.target.value)}
                                    placeholder="John Doe"
                                    icon={<Icons.User />}
                                    required
                                />
                                
                                <InputField
                                    label="Email"
                                    type="email"
                                    value={email}
                                    onChange={e => setEmail(e.target.value)}
                                    placeholder="you@example.com"
                                    icon={<Icons.Mail />}
                                    required
                                />
                                
                                <InputField
                                    label="Password"
                                    type="password"
                                    value={password}
                                    onChange={e => setPassword(e.target.value)}
                                    placeholder="Min. 8 characters"
                                    icon={<Icons.Lock />}
                                    minLength={8}
                                    required
                                />
                                
                                <SelectField
                                    label="Role"
                                    value={role}
                                    onChange={e => setRole(e.target.value)}
                                    options={[
                                        { value: 'user', label: 'User' },
                                        { value: 'admin', label: 'Admin' }
                                    ]}
                                />
                                
                                <button type="submit" className="btn btn-primary" style={{ width: '100%', marginTop: '8px' }} disabled={loading}>
                                    {loading ? <Spinner /> : 'Create Account'}
                                </button>
                            </form>
                            
                            <p style={{ textAlign: 'center', marginTop: '24px', fontSize: '14px', color: 'var(--text-secondary)' }}>
                                Already have an account?{' '}
                                <button onClick={onSwitch} style={{ background: 'none', border: 'none', color: 'var(--accent-primary)', fontWeight: '500', cursor: 'pointer' }}>
                                    Sign in
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Dashboard Page
        const DashboardPage = () => {
            const { token, logout, toast } = useAuth();
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [currentUser, setCurrentUser] = useState(null);
            const [editingUser, setEditingUser] = useState(null);
            const [deletingUser, setDeletingUser] = useState(null);
            const [deleteLoading, setDeleteLoading] = useState(false);
            
            const fetchUsers = useCallback(async () => {
                try {
                    const response = await fetch(`${API_URL}/users`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    if (!response.ok) throw new Error('Failed to fetch users');
                    
                    const data = await response.json();
                    setUsers(data);
                    
                    const tokenPayload = JSON.parse(atob(token.split('.')[1]));
                    const current = data.find(u => u.email === tokenPayload.sub);
                    setCurrentUser(current);
                } catch (err) {
                    toast(err.message, 'error');
                } finally {
                    setLoading(false);
                }
            }, [token, toast]);
            
            useEffect(() => {
                fetchUsers();
            }, [fetchUsers]);
            
            const handleDelete = async () => {
                if (!deletingUser) return;
                setDeleteLoading(true);
                
                try {
                    const response = await fetch(`${API_URL}/users/${deletingUser.id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    if (!response.ok) throw new Error('Failed to delete user');
                    
                    setUsers(users.filter(u => u.id !== deletingUser.id));
                    toast('User deleted successfully', 'success');
                    setDeletingUser(null);
                } catch (err) {
                    toast(err.message, 'error');
                } finally {
                    setDeleteLoading(false);
                }
            };
            
            const handleUserUpdated = (updatedUser) => {
                setUsers(users.map(u => u.id === updatedUser.id ? updatedUser : u));
            };
            
            const adminCount = users.filter(u => u.role === 'admin').length;
            const userCount = users.filter(u => u.role === 'user').length;
            
            return (
                <div style={{ minHeight: '100vh', padding: '24px' }}>
                    <div className="ambient-bg" />
                    <div className="noise-overlay" />
                    
                    <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
                        {/* Header */}
                        <header className="card card-elevated animate-slideUp" style={{ padding: '16px 24px', marginBottom: '32px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '16px' }}>
                            <Logo />
                            
                            <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
                                {currentUser && (
                                    <div style={{ textAlign: 'right' }}>
                                        <p style={{ fontWeight: '500', fontSize: '14px' }}>{currentUser.name}</p>
                                        <p className="font-mono" style={{ fontSize: '12px', color: 'var(--text-muted)' }}>{currentUser.role}</p>
                                    </div>
                                )}
                                <button className="btn btn-ghost" onClick={logout}>
                                    <Icons.LogOut />
                                    <span style={{ display: 'none', '@media (min-width: 640px)': { display: 'inline' } }}>Logout</span>
                                </button>
                            </div>
                        </header>
                        
                        {/* Stats */}
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px', marginBottom: '32px' }}>
                            <div className="animate-slideUp delay-1">
                                <StatCard 
                                    title="Total Users" 
                                    value={users.length} 
                                    icon={<Icons.Users />}
                                    color="110, 231, 183"
                                />
                            </div>
                            <div className="animate-slideUp delay-2">
                                <StatCard 
                                    title="Administrators" 
                                    value={adminCount}
                                    icon={<Icons.Shield />}
                                    color="251, 191, 36"
                                />
                            </div>
                            <div className="animate-slideUp delay-3">
                                <StatCard 
                                    title="Regular Users" 
                                    value={userCount}
                                    icon={<Icons.User />}
                                    color="96, 165, 250"
                                />
                            </div>
                        </div>
                        
                        {/* Users Table */}
                        <div className="card animate-slideUp delay-4">
                            <div style={{ padding: '24px', borderBottom: '1px solid var(--border-subtle)', display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '12px' }}>
                                <div>
                                    <h2 style={{ fontSize: '18px', fontWeight: '600' }}>User Management</h2>
                                    <p style={{ fontSize: '13px', color: 'var(--text-muted)', marginTop: '4px' }}>View and manage all users in your organization</p>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <span style={{ width: '8px', height: '8px', borderRadius: '50%', background: 'var(--accent-primary)', animation: 'pulse 2s infinite' }} />
                                    <span className="font-mono" style={{ fontSize: '12px', color: 'var(--text-muted)' }}>Live</span>
                                </div>
                            </div>
                            
                            {loading ? (
                                <div style={{ padding: '80px', display: 'flex', justifyContent: 'center' }}>
                                    <Spinner />
                                </div>
                            ) : users.length === 0 ? (
                                <div style={{ padding: '80px', textAlign: 'center' }}>
                                    <Icons.Users />
                                    <p style={{ marginTop: '12px', color: 'var(--text-muted)' }}>No users found</p>
                                </div>
                            ) : (
                                <div className="table-container">
                                    <table className="table">
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Role</th>
                                                <th>Created</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {users.map(user => (
                                                <UserRow
                                                    key={user.id}
                                                    user={user}
                                                    onEdit={setEditingUser}
                                                    onDelete={setDeletingUser}
                                                />
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                        </div>
                        
                        {/* Footer */}
                        <footer className="font-mono" style={{ textAlign: 'center', marginTop: '32px', fontSize: '11px', color: 'var(--text-muted)' }}>
                            Built with FastAPI + React • JWT Auth • Argon2 Hashing
                        </footer>
                    </div>
                    
                    {/* Modals */}
                    {editingUser && (
                        <EditModal
                            user={editingUser}
                            onClose={() => setEditingUser(null)}
                            onSave={handleUserUpdated}
                        />
                    )}
                    
                    {deletingUser && (
                        <DeleteModal
                            user={deletingUser}
                            onClose={() => setDeletingUser(null)}
                            onConfirm={handleDelete}
                            loading={deleteLoading}
                        />
                    )}
                </div>
            );
        };
        
        // =====================
        // AUTH PROVIDER
        // =====================
        const AuthProvider = ({ children }) => {
            const [token, setToken] = useState(localStorage.getItem('token'));
            const [toasts, setToasts] = useState([]);
            
            const login = (newToken) => {
                localStorage.setItem('token', newToken);
                setToken(newToken);
            };
            
            const logout = () => {
                localStorage.removeItem('token');
                setToken(null);
            };
            
            const toast = (message, type) => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
            };
            
            const removeToast = (id) => {
                setToasts(prev => prev.filter(t => t.id !== id));
            };
            
            return (
                <AuthContext.Provider value={{ token, login, logout, toast }}>
                    {children}
                    <div className="toast-container">
                        {toasts.map(t => (
                            <Toast key={t.id} message={t.message} type={t.type} onClose={() => removeToast(t.id)} />
                        ))}
                    </div>
                </AuthContext.Provider>
            );
        };
        
        // =====================
        // APP
        // =====================
        const App = () => {
            const [view, setView] = useState('login');
            
            return (
                <AuthProvider>
                    <AppContent view={view} setView={setView} />
                </AuthProvider>
            );
        };
        
        const AppContent = ({ view, setView }) => {
            const { token } = useAuth();
            
            if (token) return <DashboardPage />;
            if (view === 'register') return <RegisterPage onSwitch={() => setView('login')} />;
            return <LoginPage onSwitch={() => setView('register')} />;
        };
        
        // =====================
        // RENDER
        // =====================
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
